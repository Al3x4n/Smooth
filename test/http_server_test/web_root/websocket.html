<!DOCTYPE html>
<html lang="en">
<head>
    <script lang="javascript">
        let socket = null;

        function connect() {
            if(socket == null) {
                let url = ((window.location.protocol === "https:") ? "wss://" : "ws://") + window.location.host + "/chat";
                socket = new WebSocket(url);

                // Connection opened
                socket.addEventListener('open', function (event) {
                    console.log("Connected!");
                    document.getElementById("status").innerText = "Connected";
                });

                socket.addEventListener('close', function (event) {
                    console.log("Disconnected: " + event.reason);
                    document.getElementById("status").innerText = "Disconnected";
                    socket = null;
                });

                // Listen for messages
                socket.addEventListener('message', function (event) {
                    console.log('Received ' + event.data.length, event.data);
                    document.getElementById("total_count").innerText = parseInt(document.getElementById("total_count").innerText) + parseInt(event.data.length);
                    document.getElementById("last_count").innerText = event.data.length;
                });
            }
        }

        function disconnect()
        {
            if(socket != null) {
                socket.close();
            }
        }

        function send_short() {
            let s = "A".repeat(124);
            socket.send(s + "-");
        }

        function send_65k() {
            let s = "B".repeat(65534);
            socket.send(s + "-");
        }

        function send_80k() {
            let s = "C".repeat(79999);
            socket.send(s + "-");
        }

        function send_custom() {
            let s = "D".repeat(document.getElementById("custom_size").value);
            console.log("Sending " + s.length);
            socket.send(s);
        }

        function reset_total() {
            document.getElementById("total_count").innerText = 0;
        }

    </script>
</head>
<body>
    <button onclick="connect();">Connect</button>
    <button onclick="disconnect();">Disonnect</button>
    <button onclick="send_short();">Send short</button>
    <button onclick="send_65k();">Send 65k</button>
    <button onclick="send_80k();">Send 80k</button>
    <br/>
    <div id="status">Disconnected</div>
    <br/>
    <br/>
    <input type="number" id="custom_size"/>
    <button onclick="send_custom();">Send custom size</button>
    <br/>
    Total count:
    <div id="total_count">0</div>
    <button onclick="reset_total();">Reset total</button>
    <br/>
    <br/>
    Last count:
    <div id="last_count">0</div>
</body>
</html>

